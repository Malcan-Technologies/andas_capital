# API Endpoints - Penetration Testing Reference

## Overview

This document provides a comprehensive reference for penetration testing of the Kredit platform APIs. The platform infrastructure consists of:

- **AWS Cloud**: Backend API, Frontend, Admin Panel (ECS Fargate + RDS + S3)
- **Cloudflare**: DNS, WAF, SSL termination, Zero Trust Tunnel
- **On-Premises**: Signing Orchestrator, DocuSeal, MTSA (via Cloudflare Tunnel)

## Base URLs

| Service | Production URL | Infrastructure | Description |
|---------|----------------|----------------|-------------|
| Customer App | `https://andas.com.my` | AWS ECS (via Cloudflare) | Customer frontend |
| Admin Panel | `https://admin.andas.com.my` | AWS ECS (via Cloudflare) | Admin dashboard |
| Backend API | `https://api.andas.com.my` | AWS ECS (via Cloudflare) | Main backend API server |
| Signing Service | `https://sign.andas.com.my` | On-Prem (via Cloudflare Tunnel) | Document signing service |

---

## CSV Export

For spreadsheet import, see the accompanying CSV file:

**[API_ENDPOINTS.csv](./API_ENDPOINTS.csv)**

The CSV contains all endpoints with the following columns:
- `No` - Endpoint number
- `Method` - HTTP method
- `Endpoint` - API endpoint path
- `Auth_Required` - Whether authentication is required
- `Auth_Type` - Type of authentication (JWT Bearer, API Key, HMAC, None)
- `Role` - Required role (Public, User, Admin, Attestor, Admin/Attestor, Webhook, API Key)
- `Environment` - Target environment
- `Testing_Windows` - Recommended testing hours
- `External_Internal` - Network accessibility
- `Location` - Service location (AWS Backend, Signing Orchestrator)
- `Remarks` - Additional notes

---

## Endpoint Summary

| Category | Count | Auth Types |
|----------|-------|------------|
| Customer Auth | 10 | Public, JWT |
| Customer User | 9 | JWT |
| Customer Onboarding | 2 | JWT |
| Customer Products | 2 | Public |
| Customer Loan Applications | 22 | JWT |
| Customer Loans | 13 | JWT, Public |
| Customer Wallet | 6 | JWT |
| Customer Notifications | 3 | JWT |
| Customer KYC | 13 | JWT, KYC Token |
| Customer CTOS | 5 | Public, Webhook |
| Customer MTSA/PKI | 9 | JWT |
| Customer Settings | 2 | JWT, Public |
| Admin Auth | 6 | Public, JWT |
| Admin Dashboard | 3 | JWT |
| Admin Users | 5 | JWT |
| Admin Applications | 18 | JWT |
| Admin Loans | 16 | JWT |
| Admin Repayments/Payments | 10 | JWT |
| Admin Late Fees | 9 | JWT |
| Admin Early Settlement | 4 | JWT |
| Admin Disbursements | 3 | JWT |
| Admin Notifications | 12 | JWT |
| Admin Settings | 11 | JWT |
| Admin Internal Signers | 7 | JWT |
| Admin KYC | 5 | JWT |
| Admin MTSA | 6 | JWT |
| Admin Cron | 4 | JWT |
| Admin PDF Letters | 4 | JWT |
| Admin Access Logs | 2 | JWT |
| Admin Document Logs | 3 | JWT |
| DocuSeal Integration | 11 | JWT, Webhook, Public |
| Health Checks | 5 | Public, JWT |
| Signing Orchestrator | 25 | API Key, HMAC, Public |

**Total Endpoints: 267**

| Infrastructure | Count |
|----------------|-------|
| AWS Backend (via Cloudflare) | 242 |
| Signing Orchestrator (On-Prem) | 25 |

---

## Security Notes for Penetration Testing

### 1. Authentication Methods

| Method | Description | Header Format |
|--------|-------------|---------------|
| JWT Bearer | Standard JWT tokens | `Authorization: Bearer <token>` |
| API Key | Signing Orchestrator | `X-API-Key: <key>` |
| HMAC Signature | Webhook verification | Signature in request body/header |
| KYC Token | One-time KYC session token | `X-KYC-TOKEN: <token>` |
| Login Token | CSRF-like protection | `X-Login-Token: <token>` or body |

### 2. Rate Limiting

| Endpoint Type | Limit | Window |
|--------------|-------|--------|
| Login (User/Admin) | 5 attempts | 5 minutes |
| OTP Resend | 1 request | 60 seconds |
| General API | Varies | Per endpoint |

**Rate limit response:** HTTP 429 with `retryAfter` field

### 3. Token Lifetimes

| Token Type | Lifetime |
|------------|----------|
| Access Token | 15 minutes |
| Refresh Token | 90 days |
| Login Token (CSRF) | 6 minutes |
| Reset Token | 10 minutes |
| OTP | 5 minutes |

### 4. Role Hierarchy

```
ADMIN
  ├── Full system access
  ├── All admin endpoints
  └── Sensitive operations (delete users, settings, etc.)

ATTESTOR
  ├── Most admin endpoints
  ├── Application processing
  └── Limited sensitive operations

USER
  └── Customer-facing endpoints only
```

### 5. File Upload Endpoints

| Endpoint | Max Size | Allowed Types |
|----------|----------|---------------|
| `/api/loan-applications/:id/documents` | 50MB | PDF, Images |
| `/api/kyc/:kycId/upload` | 50MB | Images |
| `/api/admin/payments/csv-upload` | 50MB | CSV |
| `/api/admin/applications/:id/upload-*` | 10MB | PDF |

---

## High-Priority Targets

### Authentication Bypass
1. Login endpoints - rate limit bypass
2. Token refresh - token reuse attacks
3. Login token (CSRF) validation bypass
4. OTP verification - timing attacks
5. Password reset flow - token prediction

### Authorization Escalation
1. User → Admin role escalation via API manipulation
2. Accessing other users' resources (IDOR)
3. Admin endpoints without proper role checks
4. Attestor accessing Admin-only endpoints

### Injection Attacks
1. SQL injection in search/filter parameters
2. NoSQL injection if applicable
3. Command injection in file processing
4. LDAP injection (if applicable)

### File Upload Vulnerabilities
1. Malicious file upload (XSS, XXE)
2. Path traversal in file names
3. MIME type bypass
4. Size limit bypass

### API-Specific
1. Mass assignment vulnerabilities
2. Excessive data exposure
3. Broken object level authorization
4. Missing rate limiting on sensitive operations

---

## Common Parameters to Test

### ID Parameters (IDOR Testing)
- `id`, `userId`, `loanId`, `applicationId`
- `documentId`, `receiptId`, `transactionId`
- `kycId`, `sessionId`, `repaymentId`
- `templateId`, `groupId`, `notificationId`

### Pagination/Filter Parameters (Injection Testing)
- `limit`, `offset`, `page`
- `status`, `type`, `role`
- `search`, `query`, `filter`
- `startDate`, `endDate`
- `sort`, `order`, `sortBy`

### File Upload Fields
- Document uploads (multiple file types)
- Image uploads (KYC selfie, ID photos)
- CSV imports (payment data)
- PDF uploads (stamp certificates)

---

## Webhook Endpoints

| Endpoint | Verification | Notes |
|----------|-------------|-------|
| `POST https://api.andas.com.my/api/docuseal/webhook` | HMAC Signature | DocuSeal events |
| `POST https://api.andas.com.my/api/ctos/webhook` | None documented | CTOS callbacks |
| `POST https://sign.andas.com.my/webhooks/docuseal` | HMAC Signature | Signing orchestrator |

**Webhook Testing:**
- Signature bypass attempts
- Replay attacks
- Malformed payload injection
- Callback URL manipulation

---

## Network Considerations

### AWS Backend (via Cloudflare)
- All traffic routes through Cloudflare edge
- Cloudflare provides WAF, DDoS protection, SSL termination
- AWS Application Load Balancer for host-based routing
- ECS Fargate containers (Frontend, Admin, Backend)
- RDS PostgreSQL for primary database
- S3 for file storage
- No direct IP access - Cloudflare proxy only

### Signing Orchestrator (On-Premises)
- Accessible via Cloudflare Zero Trust Tunnel
- No public IP exposure
- API key authentication required (`X-API-Key` header)
- Separate PostgreSQL database for agreements
- Docker network isolation
- Connects to DocuSeal and MTSA internally

---

## Testing Recommendations

### Pre-Test Checklist
- [ ] Confirm testing window with stakeholders
- [ ] Obtain valid test credentials (User, Admin, Attestor)
- [ ] Configure API testing tool with correct base URLs
- [ ] Import CSV into testing tool for endpoint coverage
- [ ] Set up logging/monitoring for test traffic

### Test Execution Order
1. **Unauthenticated endpoints** - Public APIs, health checks
2. **Authentication flows** - Login, signup, password reset
3. **User-level endpoints** - As authenticated customer
4. **Admin-level endpoints** - As Admin and Attestor roles
5. **Webhook endpoints** - Signature bypass attempts
6. **Signing Orchestrator** - API key-based endpoints

### Post-Test Actions
- [ ] Document all findings with severity ratings
- [ ] Provide remediation recommendations
- [ ] Coordinate responsible disclosure timeline
- [ ] Verify critical fixes after remediation

---

## Related Documentation

- [INFRASTRUCTURE_OVERVIEW.md](./INFRASTRUCTURE_OVERVIEW.md) - Infrastructure & connectivity
- [AUTHENTICATION.md](./AUTHENTICATION.md) - Auth flows
- [Customer API Documentation](../api/CUSTOMER_API_DOCUMENTATION.md) - Customer endpoints
- [Admin API Documentation](../api/ADMIN_API_DOCUMENTATION.md) - Admin endpoints

---

*Last Updated: January 2025*
*Platform: Kredit Digital Lending Platform*
*Infrastructure: AWS Cloud + Cloudflare + On-Premises Signing*
