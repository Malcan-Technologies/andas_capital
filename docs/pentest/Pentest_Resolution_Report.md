# Penetration Test Findings — Resolution Report

**Date:** 2026-02-06
**Scope:** `*.andas.com.my` (frontend, admin, backend API, signing services)
**Reference:** Andas pentest.csv

---

## Summary

| Severity | Total | Resolved | Not Applicable (Third-Party) |
|----------|-------|----------|------------------------------|
| Medium   | 4     | 4        | 0                            |
| Low      | 4     | 3        | 1                            |
| Info     | 2     | 2        | 0                            |
| **Total** | **10** | **9**  | **1**                        |

---

## Detailed Findings and Resolutions

| # | Finding | Severity | CVSS | Affected URL | Resolution Status | Action Taken |
|---|---------|----------|------|--------------|-------------------|--------------|
| 1 | TLS Version 1.1 Protocol Detection | Medium | 6.5 | `https://*.andas.com.my/` | **Resolved** | Minimum TLS Version set to TLS 1.2 in Cloudflare Dashboard (SSL/TLS > Edge Certificates). All on-prem Nginx configs already enforce TLS 1.2/1.3. |
| 2 | TLS Version 1.0 Protocol Detection | Medium | 6.5 | `https://*.andas.com.my/` | **Resolved** | Same as above — Minimum TLS Version set to 1.2 in Cloudflare, disabling both TLS 1.0 and 1.1. |
| 3 | User Account Enumeration | Medium | 5.3 | `https://andas.com.my/signup` | **Resolved** | Backend signup endpoint (`backend/src/api/auth.ts`) now returns a generic 200 response for already-registered phone numbers instead of a 400 with "already registered" message. Frontend (`frontend/app/signup/page.tsx`) updated to handle generic response without revealing user existence. |
| 4 | Insecure Communication (HTTP accessible) | Medium | 5.3 | `http://*.andas.com.my` | **Resolved** | HSTS header (`Strict-Transport-Security: max-age=63072000; includeSubDomains; preload`) added to all three applications (frontend, admin, backend). "Always Use HTTPS" enabled in Cloudflare Dashboard for edge-level HTTP-to-HTTPS redirect. |
| 5 | Microsoft IIS Tilde Directory Enumeration | Low | 3.7 | `http://sign.andas.com.my` | **Not Applicable (Third-Party)** | This finding affects Trustgate's application infrastructure at `sign.andas.com.my`, which is not managed by Andas. Resolution is the responsibility of the third-party vendor (Trustgate). |
| 6 | Host Header Injection | Low | 3.7 | `https://sign.andas.com.my/sign_in` | **Resolved** | Added host header validation middleware to backend (`backend/src/app.ts`) that rejects requests with unexpected `Host` values and strips `X-Forwarded-Host` headers. Allowed hosts configurable via `ALLOWED_HOSTS` environment variable. |
| 7 | Clickjacking | Low | 3.1 | `https://andas.com.my/`, `https://admin.andas.com.my/` | **Resolved** | Added `X-Frame-Options: DENY` header to frontend (`frontend/next.config.js`), admin (`admin/next.config.js`), and backend (`backend/src/app.ts` via Helmet). CSP `frame-ancestors 'none'` directive also added. |
| 8 | Missing Content-Security-Policy Header | Low | 3.1 | `https://andas.com.my/`, `https://admin.andas.com.my/`, `https://api.andas.com.my/` | **Resolved** | CSP header added to all three applications with directives: `default-src 'self'`, `script-src 'self'`, `style-src 'self' 'unsafe-inline'`, `img-src 'self' data: https:`, `frame-ancestors 'none'`, `base-uri 'self'`, `object-src 'none'`. |
| 9 | Missing X-Frame-Options Header | Low | 3.1 | `https://andas.com.my/`, `https://admin.andas.com.my/`, `https://api.andas.com.my/` | **Resolved** | `X-Frame-Options: DENY` added to all three applications via Next.js `headers()` config and Helmet `frameguard`. |
| 10 | Missing HTTP Strict Transport Security Header | Info | 0.0 | `https://andas.com.my/`, `https://admin.andas.com.my/`, `https://api.andas.com.my/`, `https://sign.andas.com.my/` | **Resolved** | `Strict-Transport-Security: max-age=63072000; includeSubDomains; preload` added to frontend, admin, and backend. HSTS also enabled in Cloudflare Dashboard for edge-level enforcement. |
| 11 | Missing X-Content-Type-Options Header | Info | 0.0 | `https://andas.com.my/`, `https://admin.andas.com.my/`, `https://api.andas.com.my/` | **Resolved** | `X-Content-Type-Options: nosniff` added to all three applications via Next.js `headers()` config and Helmet `xContentTypeOptions`. |

---

## Files Modified

| File | Change Description |
|------|--------------------|
| `frontend/next.config.js` | Added `headers()` with X-Frame-Options, X-Content-Type-Options, Strict-Transport-Security, Content-Security-Policy, Referrer-Policy, Permissions-Policy |
| `admin/next.config.js` | Added `headers()` with same security headers as frontend |
| `backend/src/app.ts` | Added `helmet` middleware (CSP, HSTS, frameguard, X-Content-Type-Options, Referrer-Policy), added host header validation middleware with `X-Forwarded-Host` stripping |
| `backend/src/api/auth.ts` | Changed signup endpoint to return generic 200 response for existing users instead of revealing "already registered" |
| `frontend/app/signup/page.tsx` | Removed enumeration-revealing "already registered" error check; now handles generic response |
| `frontend/app/api/auth/signup/route.ts` | Updated to forward generic response (with or without userId) from backend |
| `backend/package.json` | Added `helmet` dependency |

---

## Cloudflare Actions Completed

The following infrastructure-level changes were applied in the Cloudflare Dashboard:

| Action | Status |
|--------|--------|
| Minimum TLS Version set to TLS 1.2 (disables TLS 1.0 and 1.1) | Completed |
| "Always Use HTTPS" enabled (forces HTTP-to-HTTPS redirect) | Completed |
| HSTS enabled at edge (`max-age=12 months`, `includeSubDomains`, `preload`) | Completed |

---

## Unresolved Items (Third-Party)

| # | Finding | Reason |
|---|---------|--------|
| 5 | Microsoft IIS Tilde Directory Enumeration (`sign.andas.com.my`) | This is Trustgate's application infrastructure, not managed by Andas. Resolution is the responsibility of the third-party vendor. |
