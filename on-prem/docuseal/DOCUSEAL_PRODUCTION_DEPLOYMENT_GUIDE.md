# DocuSeal On-Premises Production Deployment Guide

This guide helps you deploy your DocuSeal on-premises setup from your local development environment to your production server.

## üì¶ Files to Transfer

You need to transfer these files to your production server:

1. **`docuseal-onprem-deployment.tar.gz`** - Main deployment package (1.2MB)
2. **`install-docuseal-production.sh`** - Production installation script
3. **`docuseal-production.env`** - Production environment template

## üñ•Ô∏è Server Requirements

### Minimum Hardware
- **CPU**: 2 cores
- **RAM**: 4GB
- **Storage**: 20GB available space
- **Network**: Internet access for Docker image downloads

### Software Requirements
- **OS**: Ubuntu 20.04+, CentOS 8+, or similar Linux distribution
- **Docker**: Version 20.10+
- **Docker Compose**: Version 2.0+
- **Ports**: 8080 (HTTP), 8443 (HTTPS), 5433 (Database)

## üöÄ Installation Steps

### 1. Transfer Files to Server

```bash
# Option A: Using SCP
scp docuseal-onprem-deployment.tar.gz install-docuseal-production.sh docuseal-production.env user@your-server:/home/user/

# Option B: Using rsync
rsync -avz docuseal-onprem-deployment.tar.gz install-docuseal-production.sh docuseal-production.env user@your-server:/home/user/
```

### 2. Connect to Server

```bash
ssh user@your-server
cd /home/user
```

### 3. Install Docker (if not installed)

```bash
# Ubuntu/Debian
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker $USER
newgrp docker

# Verify installation
docker --version
docker compose version
```

### 4. Run Installation Script

```bash
# Make script executable
chmod +x install-docuseal-production.sh

# Run installation
./install-docuseal-production.sh
```

### 5. Configure Environment Variables

The script will prompt you to edit the `.env` file. Here are the **REQUIRED** changes:

```bash
# Open the environment file
nano docuseal-onprem/.env
```

**Critical Variables to Configure:**

| Variable | Description | Example |
|----------|-------------|---------|
| `POSTGRES_PASSWORD` | Database password | `MySecureDBPass123!` |
| `SECRET_KEY_BASE` | App secret (64+ chars) | Auto-generated by script |
| `DOCUSEAL_HOST` | Your server domain/IP | `documents.yourcompany.com` or `192.168.1.100` |

**Optional but Recommended:**

| Variable | Description | Example |
|----------|-------------|---------|
| `SMTP_ADDRESS` | Email server | `smtp.gmail.com` |
| `SMTP_USERNAME` | Email username | `docuseal@yourcompany.com` |
| `SMTP_PASSWORD` | Email password | Your app-specific password |
| `WEBHOOK_URL` | Your backend webhook | `https://api.yourcompany.com/webhook/docuseal` |
| `FORCE_SSL` | Enable HTTPS | `true` (if using SSL) |

## üåê Access and Testing

### Access URLs

After installation, DocuSeal will be available at:

- **Primary URL**: `http://YOUR_SERVER_IP:8080`
- **Direct Access**: `http://YOUR_SERVER_IP:3001`
- **With Domain**: `http://YOUR_DOMAIN:8080` (if configured)

### Initial Setup

1. **Access DocuSeal**: Open your browser to the primary URL
2. **Create Admin Account**: Follow the on-screen setup wizard
3. **Upload Test Document**: Test the signing workflow
4. **Verify Webhook**: Check webhook integration with your main backend

## üîß Production Configuration

### SSL/HTTPS Setup

To enable HTTPS for production:

1. **Get SSL Certificate**:
   ```bash
   # Using Let's Encrypt
   sudo apt install certbot
   sudo certbot certonly --standalone -d your-domain.com
   ```

2. **Update Nginx Configuration**:
   ```bash
   cd docuseal-onprem
   nano nginx/nginx.conf
   # Uncomment and configure the HTTPS server block
   ```

3. **Copy Certificates**:
   ```bash
   sudo cp /etc/letsencrypt/live/your-domain.com/fullchain.pem nginx/ssl/docuseal.crt
   sudo cp /etc/letsencrypt/live/your-domain.com/privkey.pem nginx/ssl/docuseal.key
   sudo chown $USER:$USER nginx/ssl/*
   ```

4. **Update Environment**:
   ```bash
   nano .env
   # Set FORCE_SSL=true
   # Set DOCUSEAL_HOST=your-domain.com
   ```

5. **Restart Services**:
   ```bash
   docker compose down
   docker compose up -d
   ```

### Firewall Configuration

```bash
# Ubuntu/UFW
sudo ufw enable
sudo ufw allow ssh
sudo ufw allow 8080/tcp  # HTTP
sudo ufw allow 8443/tcp  # HTTPS
sudo ufw status

# CentOS/RHEL/FirewallD
sudo firewall-cmd --permanent --add-port=8080/tcp
sudo firewall-cmd --permanent --add-port=8443/tcp
sudo firewall-cmd --reload
```

### Database Security

1. **Change Default Passwords**: Already handled in the script
2. **Restrict Database Access**: Database is only accessible from localhost by default
3. **Enable Database Backups**: Automatic daily backups are configured at 2 AM

## üìä Monitoring and Maintenance

### Daily Operations

```bash
cd docuseal-onprem

# Check service status
docker compose ps

# View logs
docker compose logs -f

# Restart services
docker compose restart

# Update to latest version
docker compose pull
docker compose up -d
```

### Backup Management

```bash
# Manual backup
./scripts/backup.sh

# View backups
ls -la postgres/backups/

# Restore from backup
./scripts/restore.sh postgres/backups/docuseal_backup_YYYYMMDD_HHMMSS.sql.gz
```

### Storage Monitoring

```bash
# Check disk usage
df -h
du -sh storage/
du -sh postgres/

# Monitor document storage
ls -la storage/documents/
ls -la storage/signed-agreements/
```

## üîó Integration with Main Backend

### Webhook Configuration

Your main backend can receive signing status updates by configuring the `WEBHOOK_URL`:

```bash
# In .env file
WEBHOOK_URL=https://your-main-backend.com/api/webhook/docuseal
```

### API Integration

DocuSeal provides REST APIs for document management:

- **Base URL**: `http://YOUR_SERVER:8080/api`
- **Authentication**: API tokens (configured in DocuSeal admin)
- **Endpoints**: Create templates, send documents, check status

## üÜò Troubleshooting

### Common Issues

**Service won't start:**
```bash
# Check logs
docker compose logs
# Check disk space
df -h
# Check permissions
ls -la storage/
```

**Database connection failed:**
```bash
# Test database
docker compose exec docuseal-postgres psql -U docuseal -d docuseal -c "SELECT version();"
# Restart database
docker compose restart docuseal-postgres
```

**Can't access web interface:**
```bash
# Check nginx status
curl http://localhost:8080/health
# Check firewall
sudo ufw status
# Check DocuSeal app
curl http://localhost:3001/health
```

### Log Locations

- **Application Logs**: `docker compose logs docuseal`
- **Database Logs**: `docker compose logs docuseal-postgres`
- **Nginx Logs**: `logs/nginx/access.log` and `logs/nginx/error.log`
- **Backup Logs**: `logs/backup.log`

## üîÑ Updates and Upgrades

### Update DocuSeal

```bash
cd docuseal-onprem

# Pull latest images
docker compose pull

# Restart with new images
docker compose down
docker compose up -d

# Verify update
curl http://localhost:8080/health
```

### System Updates

```bash
# Update system packages
sudo apt update && sudo apt upgrade

# Update Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
```

## üìû Support

- **DocuSeal Documentation**: [https://docs.docuseal.co/](https://docs.docuseal.co/)
- **Docker Documentation**: [https://docs.docker.com/](https://docs.docker.com/)
- **Application Logs**: Check container logs for specific error messages
- **Health Checks**: Use the built-in health endpoints for monitoring

---

## üèÅ Quick Reference

```bash
# Essential commands
cd docuseal-onprem
docker compose ps                    # Status
docker compose logs -f              # Logs
docker compose restart              # Restart
./scripts/backup.sh                 # Backup
docker compose pull && docker compose up -d  # Update
```

**Default Ports:**
- HTTP: 8080
- HTTPS: 8443
- Direct App: 3001
- Database: 5433

**Important Files:**
- Configuration: `.env`
- Logs: `logs/nginx/`
- Documents: `storage/documents/`
- Backups: `postgres/backups/`
